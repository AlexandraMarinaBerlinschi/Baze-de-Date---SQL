--1 
SELECT P.NUME, P.PRENUME
FROM PACIENT P
JOIN CONSULTATIE C ON P.ID_PACIENT = C.ID_PACIENT
JOIN PRESCRIPTIE PR ON C.ID_CONSULTATIE = PR.ID_CONSULTATIE
JOIN MEDICAMENT M ON PR.ID_MEDICAMENT = M.ID_MEDICAMENT
WHERE UPPER(M.NUME) LIKE 'IBUPROFEN';

--2
SELECT D.ID_DOCTOR, D.NUME, D.PRENUME, D.SALARIU, D.ID_SECTIE, COUNT(C.ID_CONSULTATIE) AS NRCONSULTATII
FROM DOCTOR D
JOIN CONSULTATIE C ON D.ID_DOCTOR = C.ID_DOCTOR
GROUP BY D.ID_DOCTOR, D.NUME, D.PRENUME, D.SALARIU, D.ID_SECTIE
HAVING COUNT(C.ID_CONSULTATIE) >= 2 
ORDER BY D.SALARIU DESC, NRCONSULTATII ASC;

--3
SELECT 
  S.NUME, COALESCE(D.NUME, '-'), COALESCE(D.PRENUME, '-'), COALESCE(D.SALARIU, 0)
FROM SECTIE S
LEFT JOIN (
  SELECT 
    D.ID_SECTIE, D.NUME, D.PRENUME, D.SALARIU
  FROM DOCTOR D
  JOIN (
    SELECT 
      ID_SECTIE, MAX(SALARIU) AS MAX_SALARIU
    FROM DOCTOR
    GROUP BY ID_SECTIE
  ) MAX_DOCTOR_SALARIU
  ON D.ID_SECTIE = MAX_DOCTOR_SALARIU.ID_SECTIE
  AND D.SALARIU = MAX_DOCTOR_SALARIU.MAX_SALARIU
) D
ON S.ID_SECTIE = D.ID_SECTIE;

--4

SELECT
P.NUME, P.PRENUME, COUNT(C.ID_CONSULTATIE) AS NRCONSULTATII
FROM PACIENT P
JOIN SECTIE S ON P.ID_SECTIE = S.ID_SECTIE
JOIN CONSULTATIE C ON P.ID_PACIENT = C.ID_PACIENT
GROUP BY P.ID_SECTIE, P.NUME, P.PRENUME
HAVING COUNT(C.ID_CONSULTATIE) = (
    SELECT
        MIN(NRCONSULTATII)
    FROM (
        SELECT
            S.ID_SECTIE, COUNT(C.ID_CONSULTATIE) AS NRCONSULTATII
        FROM SECTIE S
        JOIN PACIENT P ON S.ID_SECTIE = P.ID_SECTIE
        JOIN CONSULTATIE C ON P.ID_PACIENT = C.ID_PACIENT
        GROUP BY S.ID_SECTIE
        ) MIN_NRCONSULTATII
    WHERE P.ID_SECTIE = MIN_NRCONSULTATII.ID_SECTIE
    );
